"use strict";const ThemeManager={STORAGE_KEY:"dashboard-theme",LIGHT:"light",DARK:"dark",init(){this.setup(),this.attachEventListeners()},setup(){const t=localStorage.getItem(this.STORAGE_KEY),e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=t||(e?this.DARK:this.LIGHT);this.set(i)},set(t){document.documentElement.setAttribute("data-bs-theme",t),localStorage.setItem(this.STORAGE_KEY,t),this.updateToggleButton(t)},toggle(){const t=document.documentElement.getAttribute("data-bs-theme")===this.LIGHT?this.DARK:this.LIGHT;this.set(t)},updateToggleButton(t){const e=document.getElementById("theme-toggle");if(e){const i=e.querySelector("i");i&&(i.className=t===this.DARK?"bi bi-sun":"bi bi-moon-stars")}},attachEventListeners(){const t=document.getElementById("theme-toggle");t&&t.addEventListener("click",()=>this.toggle())}},SidebarManager={STORAGE_KEY:"dashboard-sidebar-state",sidebar:null,mainContent:null,toggleBtn:null,init(){this.sidebar=document.getElementById("sidebar-nav"),this.mainContent=document.getElementById("main-content"),this.toggleBtn=document.getElementById("sidebar-toggle"),this.sidebar&&this.mainContent&&this.toggleBtn&&(this.setup(),this.attachEventListeners())},setup(){"collapsed"===localStorage.getItem(this.STORAGE_KEY)&&this.collapse(!1)},toggle(){this.sidebar.classList.contains("collapsed")?this.expand():this.collapse(!0)},collapse(t=!0){t||(this.sidebar.style.transition="none",this.mainContent.style.transition="none"),this.sidebar.classList.add("collapsed"),this.mainContent.classList.add("expanded"),localStorage.setItem(this.STORAGE_KEY,"collapsed"),this.updateToggleButton(!0),t||(this.sidebar.offsetHeight,this.sidebar.style.transition="",this.mainContent.style.transition="")},expand(){this.sidebar.classList.remove("collapsed"),this.mainContent.classList.remove("expanded"),localStorage.setItem(this.STORAGE_KEY,"expanded"),this.updateToggleButton(!1)},updateToggleButton(t){const e=this.toggleBtn.querySelector("i");e&&(e.className=t?"bi bi-layout-sidebar-inset-reverse":"bi bi-layout-sidebar-inset"),this.toggleBtn.title=t?"Show sidebar":"Hide sidebar"},attachEventListeners(){this.toggleBtn.addEventListener("click",()=>this.toggle())}},Navigation={init(){this.highlightCurrentPage(),this.attachLinkListeners()},highlightCurrentPage(){const t=window.location.pathname;document.querySelectorAll(".nav-link").forEach(e=>{const i=e.getAttribute("href");"/"===i&&"/"===t||"/"!==i&&t.startsWith(i)?e.classList.add("active"):e.classList.remove("active")})},attachLinkListeners(){document.querySelectorAll(".nav-link").forEach(t=>{t.addEventListener("click",()=>{const t=document.querySelector(".navbar-collapse");t&&t.classList.contains("show")&&document.querySelector(".navbar-toggler").click()})})}},StatusMonitor={CHECK_INTERVAL:3e4,indicator:null,init(){this.indicator=document.getElementById("status-indicator"),this.indicator&&(this.checkHealth(),setInterval(()=>this.checkHealth(),this.CHECK_INTERVAL))},checkHealth(){fetch("/health").then(t=>{t.ok?this.setStatus("Active","success"):this.setStatus("Degraded","warning")}).catch(()=>{this.setStatus("Offline","danger")})},setStatus(t,e){this.indicator&&(this.indicator.textContent=t,this.indicator.className=`badge bg-${e}`)}},TableInteraction={init(){this.makeRowsClickable()},makeRowsClickable(){document.querySelectorAll("[data-href]").forEach(t=>{t.style.cursor="pointer",t.addEventListener("click",e=>{e.target.closest("button, a")||(window.location.href=t.getAttribute("data-href"))}),t.addEventListener("keypress",e=>{"Enter"===e.key&&(window.location.href=t.getAttribute("data-href"))})})}},Notifications={show(t,e="info",i=3e3){const n=document.getElementById("notification-container")||this.createContainer(),a=document.createElement("div");a.className=`alert alert-${e} alert-dismissible fade show`,a.innerHTML=`\n            ${t}\n            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n        `,n.appendChild(a),i&&setTimeout(()=>a.remove(),i)},createContainer(){const t=document.createElement("div");return t.id="notification-container",t.style.cssText="position: fixed; top: 80px; right: 20px; z-index: 1050; width: 350px; max-width: calc(100% - 20px);",document.body.appendChild(t),t}},LoadingState={show(t){t.classList.add("loading")},hide(t){t.classList.remove("loading")}},MonitoringControl={init(){this.attachEventListeners(),this.updateStatus(),setInterval(()=>this.updateStatus(),3e4)},async updateStatus(){try{const t=await fetch("/api/monitoring/status");if(!t.ok)throw new Error("Failed to fetch monitoring status");const e=await t.json();this.updateUI(e.active)}catch(t){console.error("Error fetching monitoring status:",t),this.updateUI(null)}},updateUI(t){const e=document.getElementById("monitoring-status"),i=document.getElementById("start-monitoring"),n=document.getElementById("stop-monitoring"),a=document.getElementById("restart-monitoring"),s=document.getElementById("dashboard-monitoring-status"),o=document.getElementById("dashboard-monitoring-text"),r=document.getElementById("dashboard-monitoring-desc");e&&(i&&!i.innerHTML.includes("Start")&&(i.innerHTML='<i class="bi bi-play-fill"></i> Start'),n&&!n.innerHTML.includes("Stop")&&(n.innerHTML='<i class="bi bi-stop-fill"></i> Stop'),a&&!a.innerHTML.includes("Restart")&&(a.innerHTML='<i class="bi bi-arrow-clockwise"></i> Restart'),null===t?(e.textContent="Unknown",e.className="badge bg-secondary",s&&(s.className="badge bg-secondary"),o&&(o.textContent="Unknown"),r&&(r.textContent="Status unavailable"),i&&(i.disabled=!0),n&&(n.disabled=!0),a&&(a.disabled=!0)):t?(e.textContent="Running",e.className="badge bg-success",s&&(s.className="badge bg-success"),o&&(o.textContent="Active"),r&&(r.textContent="Real-time monitoring enabled"),i&&(i.disabled=!0),n&&(n.disabled=!1),a&&(a.disabled=!1)):(e.textContent="Stopped",e.className="badge bg-danger",s&&(s.className="badge bg-danger"),o&&(o.textContent="Stopped"),r&&(r.textContent="Monitoring is currently disabled"),i&&(i.disabled=!1),n&&(n.disabled=!0),a&&(a.disabled=!0)))},async performAction(t,e){try{const e=await fetch(`/api/monitoring/${t}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to ${t} monitoring`);const i=await e.json();i.success?Notifications.show(i.message,"success"):Notifications.show(i.message,"danger"),await this.updateStatus()}catch(i){console.error(`Error ${e} monitoring:`,i),Notifications.show(`Failed to ${t} monitoring`,"danger"),await this.updateStatus()}},attachEventListeners(){const t=document.getElementById("start-monitoring"),e=document.getElementById("stop-monitoring"),i=document.getElementById("restart-monitoring");t&&t.addEventListener("click",()=>this.performAction("start","Starting")),e&&e.addEventListener("click",()=>this.performAction("stop","Stopping")),i&&i.addEventListener("click",()=>this.performAction("restart","Restarting"))}},MonitoringFeaturesToggle={STORAGE_KEY:"monitoring-features-collapse",init(){const t=document.getElementById("monitoring-features"),e=document.querySelector('[data-bs-target="#monitoring-features"]');if(!t||!e||!window.bootstrap)return;const i=(()=>{try{return localStorage.getItem(this.STORAGE_KEY)}catch(t){return null}})(),n=new bootstrap.Collapse(t,{toggle:!1});"collapsed"===i?(n.hide(),e.setAttribute("aria-expanded","false")):(n.show(),e.setAttribute("aria-expanded","true")),t.addEventListener("hidden.bs.collapse",()=>{try{localStorage.setItem(this.STORAGE_KEY,"collapsed")}catch(t){}e.setAttribute("aria-expanded","false")}),t.addEventListener("shown.bs.collapse",()=>{try{localStorage.setItem(this.STORAGE_KEY,"expanded")}catch(t){}e.setAttribute("aria-expanded","true")})}};document.addEventListener("DOMContentLoaded",()=>{ThemeManager.init(),SidebarManager.init(),Navigation.init(),StatusMonitor.init(),TableInteraction.init(),MonitoringControl.init(),MonitoringFeaturesToggle.init(),window.addEventListener("error",t=>{console.error("Error:",t.error),Notifications.show("An error occurred. Please try again.","danger")})}),window.Dashboard={Notifications:Notifications,LoadingState:LoadingState,ThemeManager:ThemeManager,SidebarManager:SidebarManager,MonitoringControl:MonitoringControl};