!function(){function e(e){if(!e||"true"===e.dataset.enhanced)return;const t=e.closest(".tab-pane");if(t&&console.log("Table in tab pane:",t.id,"active:",t.classList.contains("active")),t&&!t.classList.contains("active"))return void console.log("Skipping table in inactive pane:",t.id);console.log("Enhancing table in pane:",t?.id||"no pane");const n=e.querySelector("tbody");if(!n)return;const a=Array.from(n.querySelectorAll("tr")),o=parseInt(e.dataset.perPage||"25",10)||25,c="true"===e.dataset.tagFilter;let l=a.slice(),s=null,r=1,d=1,i="all";const m=new Set;c&&a.forEach(e=>{(e.dataset.tags||"").split(",").map(e=>e.trim()).filter(Boolean).forEach(e=>m.add(e))});const u=document.createElement("div");u.className="table-enhance-controls d-flex align-items-center justify-content-between gap-2 mb-2 flex-wrap";const p=document.createElement("input");p.type="search",p.className="form-control form-control-sm",p.placeholder="Search table...",p.style.maxWidth="240px";const h=document.createElement("div");h.className="d-flex flex-wrap gap-2";const b=document.createElement("div");if(b.className="small text-muted",u.appendChild(p),c&&m.size>0){const e=document.createElement("button");e.type="button",e.className="btn btn-outline-secondary btn-sm active",e.textContent="All",e.addEventListener("click",()=>{i="all",g(e),d=1,N()}),h.appendChild(e),Array.from(m).sort().forEach(e=>{const t=document.createElement("button");t.type="button",t.className="btn btn-outline-secondary btn-sm",t.textContent=e,t.dataset.tag=e,t.addEventListener("click",()=>{i=e,g(t),d=1,N()}),h.appendChild(t)}),u.appendChild(h)}function g(e){h.querySelectorAll("button").forEach(t=>{t.classList.toggle("active",t===e)})}u.appendChild(b),e.parentNode.insertBefore(u,e);const f=document.createElement("div");f.className="d-flex justify-content-between align-items-center mt-2 flex-wrap gap-2";const y=document.createElement("div");y.className="small text-muted";const E=document.createElement("div");E.className="btn-group btn-group-sm";const v=document.createElement("button");v.type="button",v.className="btn btn-outline-secondary",v.textContent="Prev";const x=document.createElement("button");x.type="button",x.className="btn btn-outline-secondary",x.textContent="Next",E.append(v,x),f.append(y,E),e.parentNode.appendChild(f);function N(){const e=p.value.trim().toLowerCase();l=a.filter(t=>{if(!(!e||t.textContent.toLowerCase().includes(e)))return!1;if(c&&"all"!==i){return(t.dataset.tags||"").split(",").map(e=>e.trim()).filter(Boolean).includes(i)}return!0}),null!==s&&l.sort((e,t)=>{const n=(e.children[s]?.textContent||"").trim(),a=(t.children[s]?.textContent||"").trim(),o=parseFloat(n.replace(/[^0-9.-]+/g,"")),c=parseFloat(a.replace(/[^0-9.-]+/g,"")),l=!isNaN(o),d=!isNaN(c);return l&&d?(o-c)*r:n.localeCompare(a)*r});const t=Math.max(1,Math.ceil(l.length/o));d>t&&(d=t);const n=(d-1)*o,m=n+o;a.forEach(e=>e.style.display="none"),l.slice(n,m).forEach(e=>e.style.display=""),b.textContent=`${l.length} items`,y.textContent=`Page ${d} / ${t}`,v.disabled=d<=1,x.disabled=d>=t}Array.from(e.querySelectorAll("thead th")).forEach((e,t)=>{e.style.cursor="pointer",e.addEventListener("click",()=>{s===t?r*=-1:(s=t,r=1),N()})}),p.addEventListener("input",()=>{d=1,N()}),v.addEventListener("click",()=>{d>1&&(d-=1,N())}),x.addEventListener("click",()=>{const e=Math.max(1,Math.ceil(l.length/o));d<e&&(d+=1,N())}),e.dataset.enhanced="true",N()}function t(e){if(!e||"true"===e.dataset.enhanced)return;const t=Array.from(e.querySelectorAll("[data-card-item]"));if(0===t.length)return;const n=parseInt(e.dataset.perPage||"8",10)||8,a=parseInt(e.dataset.compactThreshold||"6",10)||6;let o=1;const c=document.querySelector(`[data-card-grid-pager="${e.dataset.cardGrid}"]`)||e.nextElementSibling,l=document.createElement("div");l.className="d-flex justify-content-between align-items-center mt-2 flex-wrap gap-2 card-grid-controls";const s=document.createElement("div");s.className="small text-muted";const r=document.createElement("div");r.className="btn-group btn-group-sm";const d=document.createElement("button");d.type="button",d.className="btn btn-outline-secondary",d.textContent="Prev";const i=document.createElement("button");function m(){const c=Math.max(1,Math.ceil(t.length/n));o>c&&(o=c);const r=(o-1)*n,m=r+n;t.forEach((e,t)=>{e.style.display=t>=r&&t<m?"":"none"}),t.length>a?e.classList.add("overview-compact"):e.classList.remove("overview-compact");const u=Math.max(0,Math.min(t.length,m)-r);s.textContent=`${u} shown of ${t.length}`,d.disabled=o<=1,i.disabled=o>=c,l.style.display=c>1?"flex":"none"}i.type="button",i.className="btn btn-outline-secondary",i.textContent="Next",r.append(d,i),l.append(s,r),(c||e).appendChild(l),d.addEventListener("click",()=>{o>1&&(o-=1,m())}),i.addEventListener("click",()=>{const e=Math.max(1,Math.ceil(t.length/n));o<e&&(o+=1,m())}),e.dataset.enhanced="true",m()}document.addEventListener("DOMContentLoaded",()=>{console.log("=== Enhancements.js initializing ==="),function(){const e=window.dashboardUI||{},t=!!e.enableAutoRefresh,n=Number(e.autoRefreshSeconds)>0?Number(e.autoRefreshSeconds):0;t&&n>0&&setTimeout(()=>window.location.reload(),1e3*n)}(),document.querySelectorAll("table.table-enhance").forEach(t=>{const n=t.closest(".tab-pane");n&&!n.classList.contains("active")||e(t)}),document.querySelectorAll("[data-card-grid]").forEach(t),document.querySelectorAll('[data-bs-toggle="tab"]').forEach(t=>{t.addEventListener("shown.bs.tab",t=>{console.log("Tab shown event:",t.target.textContent.trim());const n=t.target.getAttribute("data-bs-target");if(console.log("Target pane:",n),n){const t=document.querySelector(n);t&&(console.log("Found pane, enhancing tables..."),t.querySelectorAll("table.table-enhance").forEach(t=>{"true"!==t.dataset.enhanced?(console.log("Enhancing table in newly shown tab"),e(t)):console.log("Table already enhanced")}))}})})})}();